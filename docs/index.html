<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RAOD3R ‚Äì AO3 Reader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* ====== Theme Variables ====== */
    :root {
      --bg: #f4f4f9;
      --text: #222;
      --card-bg: #fff;
      --header-bg: #6200ea;
      --header-text: #fff;
      --button-bg: #6200ea;
      --button-text: #fff;
      --shadow: rgba(0,0,0,0.1);
      --font-size: 1rem;
    }
    body.dark {
      --bg: #121212;
      --text: #eee;
      --card-bg: #1e1e1e;
      --header-bg: #3700b3;
      --header-text: #fff;
      --button-bg: #bb86fc;
      --button-text: #000;
      --shadow: rgba(0,0,0,0.5);
    }

    /* ====== Base Styles ====== */
    body {
      font-family: "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }
    header {
      background: var(--header-bg);
      color: var(--header-text);
      padding: 1rem;
      text-align: center;
      box-shadow: 0 2px 6px var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }
    #dark-toggle {
      background: transparent;
      border: 1px solid var(--header-text);
      color: var(--header-text);
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      cursor: pointer;
    }

    /* ====== Search + Filters ====== */
    #search-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      padding: 1rem;
      background: var(--card-bg);
      box-shadow: 0 2px 6px var(--shadow);
      transition: background 0.3s;
    }
    #search-bar input, #search-bar select, #search-bar button {
      padding: 0.6rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1rem;
      background: var(--card-bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }
    #search-bar button {
      background: var(--button-bg);
      color: var(--button-text);
      cursor: pointer;
      border: none;
      transition: 0.2s;
    }
    #search-bar button:hover {
      opacity: 0.8;
    }

    /* ====== Story List ====== */
    #results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .story-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 4px 10px var(--shadow);
      display: flex;
      flex-direction: column;
      transition: transform 0.2s, background 0.3s, color 0.3s;
    }
    .story-card:hover {
      transform: translateY(-4px);
    }
    .story-card h3 {
      margin: 0 0 0.5rem;
      font-size: 1.3rem;
      color: var(--text);
    }
    .story-meta {
      font-size: 0.9rem;
      color: #888;
      margin-bottom: 0.6rem;
    }
    body.dark .story-meta {
      color: #aaa;
    }
    .story-summary {
      flex-grow: 1;
      font-size: 0.95rem;
      margin-bottom: 1rem;
    }
    .story-card button {
      align-self: flex-start;
      padding: 0.5rem 0.8rem;
      border: none;
      border-radius: 6px;
      background: var(--button-bg);
      color: var(--button-text);
      cursor: pointer;
      font-size: 0.9rem;
    }

    /* ====== Reader View ====== */
    #reader {
      display: none;
      padding: 1rem 2rem;
      max-width: 800px;
      margin: auto;
      background: var(--card-bg);
      box-shadow: 0 4px 12px var(--shadow);
      border-radius: 12px;
      transition: background 0.3s, color 0.3s;
      font-size: var(--font-size);
    }
    #reader h2 {
      margin-top: 0;
    }
    #reader .chapter {
      margin-bottom: 2rem;
      line-height: 1.6;
    }
    #back-btn, .nav-btn {
      margin: 0.5rem;
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 6px;
      background: var(--button-bg);
      color: var(--button-text);
      cursor: pointer;
    }

    /* ====== Font Adjuster ====== */
    #font-controls {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    #font-controls button {
      padding: 0.4rem 0.8rem;
      border: none;
      border-radius: 6px;
      background: var(--button-bg);
      color: var(--button-text);
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>üìñ RAOD3R ‚Äì AO3 Reader</h1>
    <button id="dark-toggle">üåô Dark Mode</button>
  </header>

  <!-- Search & Filters -->
  <section id="search-bar">
    <input type="text" id="tag" placeholder="Search by tag (e.g. romance)">
    <select id="rating">
      <option value="">Any Rating</option>
      <option>General</option>
      <option>Teen</option>
      <option>Mature</option>
      <option>Explicit</option>
    </select>
    <input type="text" id="fandom" placeholder="Fandom (optional)">
    <label>
      <input type="checkbox" id="completed"> Completed only
    </label>
    <button onclick="doSearch()">Search</button>
  </section>

  <!-- Results -->
  <section id="results"></section>

  <!-- Reader -->
  <section id="reader">
    <button id="back-btn" onclick="closeReader()">‚¨Ö Back</button>
    <div id="font-controls">
      <button onclick="adjustFont(-0.1)">A-</button>
      <button onclick="adjustFont(0.1)">A+</button>
    </div>
    <div id="story-content"></div>
    <div id="chapter-nav">
      <button class="nav-btn" onclick="prevChapter()">‚¨Ö Previous</button>
      <button class="nav-btn" onclick="nextChapter()">Next ‚û°</button>
    </div>
  </section>

  <script>
    const API = "https://raod3r.onrender.com";
    let currentStory = null;
    let currentChapter = 0;

    async function doSearch() {
      const tag = document.getElementById("tag").value || "romance";
      const rating = document.getElementById("rating").value;
      const fandom = document.getElementById("fandom").value;
      const completed = document.getElementById("completed").checked;

      let url = `${API}/search?tag=${encodeURIComponent(tag)}`;
      if (rating) url += `&rating=${encodeURIComponent(rating)}`;
      if (fandom) url += `&fandom=${encodeURIComponent(fandom)}`;
      if (completed) url += `&completed=true`;

      const res = await fetch(url);
      const data = await res.json();

      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      data.results.forEach(story => {
        const card = document.createElement("div");
        card.className = "story-card";
        card.innerHTML = `
          <h3>${story.title}</h3>
          <div class="story-meta">By ${story.author} | ${story.fandom} | ${story.rating}</div>
          <div class="story-summary">${story.summary}</div>
          <button onclick="openStory('${story.id}')">Read</button>
        `;
        resultsDiv.appendChild(card);
      });
    }

    async function openStory(id) {
      document.getElementById("results").style.display = "none";
      const reader = document.getElementById("reader");
      reader.style.display = "block";

      const res = await fetch(`${API}/story/${id}`);
      currentStory = await res.json();
      currentChapter = 0;

      showChapter();
    }

    function showChapter() {
      const content = document.getElementById("story-content");
      content.innerHTML = `
        <h2>${currentStory.title}</h2>
        <p><em>By ${currentStory.author}</em></p>
        <p>${currentStory.summary}</p>
        <div class="chapter">${currentStory.chapters[currentChapter]}</div>
        <p><em>Chapter ${currentChapter + 1} of ${currentStory.chapters.length}</em></p>
      `;
    }

    function nextChapter() {
      if (currentChapter < currentStory.chapters.length - 1) {
        currentChapter++;
        showChapter();
      }
    }

    function prevChapter() {
      if (currentChapter > 0) {
        currentChapter--;
        showChapter();
      }
    }

    function closeReader() {
      document.getElementById("reader").style.display = "none";
      document.getElementById("results").style.display = "grid";
    }

    // === Font Adjuster ===
    function adjustFont(delta) {
      const style = getComputedStyle(document.documentElement);
      let size = parseFloat(style.getPropertyValue('--font-size'));
      size = Math.max(0.6, Math.min(2.5, size + delta));
      document.documentElement.style.setProperty('--font-size', size + "rem");
    }

    // === Dark Mode Toggle ===
    const darkBtn = document.getElementById("dark-toggle");
    if (localStorage.getItem("theme") === "dark") {
      document.body.classList.add("dark");
      darkBtn.textContent = "‚òÄÔ∏è Light Mode";
    }
    darkBtn.onclick = () => {
      document.body.classList.toggle("dark");
      if (document.body.classList.contains("dark")) {
        darkBtn.textContent = "‚òÄÔ∏è Light Mode";
        localStorage.setItem("theme", "dark");
      } else {
        darkBtn.textContent = "üåô Dark Mode";
        localStorage.setItem("theme", "light");
      }
    };

    // Auto-load romance on first visit
    doSearch();
  </script>
</body>
</html>
